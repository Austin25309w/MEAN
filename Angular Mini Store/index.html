<!DOCTYPE html>
<html style="margin: 20px;" ng-app='myApp'>
<head>
	<title>Players and Teams</title>
	<script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.3.5/angular.min.js"></script>
	<script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.3.5/angular-route.min.js"></script>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
	<script type="text/javascript">
		var myApp = angular.module('myApp',[]);

		myApp.factory('customerFactory', function(){
			var d1 = new Date(2016,1,1);
			var d2 = new Date(2015,2,1);
			var d3 = new Date(2014,3,1);
			var d4 = new Date(2013,4,1);
			var customers = [
				{name: "Michael Choi", date: d1},
				{name: "John Supsupin", date: d2},
				{name: "Trey Villafane", date: d3},
				{name: "India Meisner", date: d4}
			];

			var factory = {};

			factory.getCustomers = function(callback){callback(customers)};
			
			factory.addCustomer = function(newCustomer){
				var d = Date.now()
				newCustomer.date = d;
				customers.push(newCustomer);
			}

			factory.deleteCustomer = function(customer){
				customers.splice(customers.indexOf(customer),1);
			}

			return factory;
		});

		myApp.controller('customersController', function($scope,customerFactory){
			$scope.customers = [];
			customerFactory.getCustomers(function(data){
				$scope.customers = data;
			})

			$scope.addCustomer = function(){
				for(i in $scope.customers){
					dupes = $scope.customers[i].name==$scope.newCustomer.name;
				}
				if(dupes)
					alert("Cannot add duplicate name");
				else
					customerFactory.addCustomer($scope.newCustomer);
				$scope.newCustomer = {};
			}

			$scope.deleteCustomer = function(customer){
				customerFactory.deleteCustomer(customer);
			}
		})
	</script>
<body ng-controller='customersController'>
	<form class="form-group" style="margin-top: 20px;">
		<label>Name</label>
		<input class="form-control" type="text" style="width: 25%;" ng-model='newCustomer.name'></input><br>
		<input type="submit" ng-click='addCustomer()' value="Add"></input>
	</form><br>

	<input placeholder="search name..." type="text" ng-model='name_filter'></input><br><br>
	<table class="table table-striped" style="border:1px solid tan;">
		<thead>
			<tr>
				<th>Customer Name</th>
				<th>Created Date</th>
				<th>Actions</th>
			</tr>
		</thead>
		<tbody>
			<tr ng-repeat="customer in customers | filter:name_filter | orderBy: 'customer.date':true">
				<td ng-bind='customer.name'></td>
				<td ng-bind="customer.date | date:'MMMM d, y'"></td>
				<td><button ng-click='deleteCustomer(customer)'>Remove</button></td>
			</tr>
		</tbody>
	</table>
</body>
</html>